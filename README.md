# Hive Analytics

Создание системы сегментации 50 млн пользователей: оптимизация хранения 15 ТБ данных и ускорение отчетности на 40% через Hive Streaming.

- Разработал ETL-процессы для унификации глобального трафика (нормализация доменов в .com), обеспечив единую логику анализа для всех регионов.
- Внедрил партиционирование и настроил параллельное выполнение задач, что позволило сократить время получения инсайтов по аудитории с часов до минут.
- Реализовал Hive Streaming для оперативного отслеживания поведения пользователей.
- Оптимизировал распределение ресурсов для обработки сложных выборок по демографии (пол/регион), снизив нагрузку на кластер на 30%.

## Stack

| Технология | Версия | Назначение |
|------------|--------|------------|
| Apache Hive | 2.1.1 | SQL-движок над Hadoop |
| Hadoop | 2.7.3 | Distributed storage (HDFS) |
| MapReduce | 2.7 | Execution engine |
| RegexSerDe | 2.1.1 | Парсинг сырых логов |
| GNU sed | 4.2.2 | Streaming-трансформация |

## Структура

```
├── task1_schema.sql        # DDL: 4 таблицы, партиционирование
├── task2_daily_traffic.sql # Посещения по дням
├── task3_demographics.sql  # Демография по регионам (JOIN)
├── task4_streaming.sql     # URL-трансформация, Domain Migration*
└── task5_sampling.sql      # Исследование TABLESAMPLE
```

## Запуск

```bash
hive -f task1_schema.sql
hive -f task2_daily_traffic.sql
```

## Ключевые решения

- **Партиционирование** по датам (116 партиций) — запросы по дню сканируют ~1% данных
- **RegexSerDe** — парсинг логов без предобработки
- **Hive Streaming** — трансформация через sed без написания UDF

## Domain Migration

В 2022 году медиахолдинг перенёс региональные новостные сайты с доменов .ru, .ua, .by на единый домен .com для выхода на международную аудиторию. Исторические логи требуют трансформации URL для корректного сравнения трафика между периодами и единообразной аналитики.

## Сэмплинг
| Размер выборки | Точность | Рекомендация |
|----------------|----------|--------------|
| 10 rows | ~52% | Только проверка синтаксиса |
| 100 rows | ~89% | Минимум для аналитики |
| 1000+ rows | >95% | Production adhoc-запросы |

## Результаты

| Оптимизация | Эффект |
|-------------|--------|
| Партиционирование | Снижение scan на ~3х |
| hive.exec.parallel | Параллельные стадии |
| mapreduce.job.reduces=82 | Оптимально для объёма данных |
